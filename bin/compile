#!/usr/bin/env bash
# bin/compile <build-dir>
BUILD_DIR=$1
GHOSTSCRIPT_VERSION="$(cat $BUILD_DIR/.ghostscript_version)"

echo "-----> Installing $GHOSTSCRIPT_VERSION using build directory $1"

LOCATION="$BUILD_DIR/vendor/gs"
PACKAGE="https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs${GHOSTSCRIPT_VERSION//./}/ghostscript-$GHOSTSCRIPT_VERSION-linux-x86_64.tgz"
BINARY="ghostscript-$GHOSTSCRIPT_VERSION-linux-x86_64/gs-${GHOSTSCRIPT_VERSION//./}-linux-x86_64"

cd $BUILD_DIR
mkdir -p $LOCATION/bin
wget -O gs.tgz $PACKAGE
tar xvf gs.tgz
mv $BINARY $LOCATION/bin/gs

echo "-----> Building runtime environment for Ghostscript to $LOCATION"

mkdir -p $BUILD_DIR/.profile.d
echo "export PATH=\"\$HOME/vendor/gs/bin:\$PATH\"" > $BUILD_DIR/.profile.d/ghostscript.sh
